module.exports=[70755,85078,56771,55069,a=>{"use strict";let b=Object.create(null),c=a=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(a?b:globalThis),d=new Proxy(b,{get:(a,d)=>c()[d]??b[d],has:(a,d)=>d in c()||d in b,set:(a,b,d)=>(c(!0)[b]=d,!0),deleteProperty(a,b){if(!b)return!1;let d=c(!0);return delete d[b],!0},ownKeys:()=>Object.keys(c(!0))}),e="undefined"!=typeof process&&process.env&&"production"||"",f="production"===e,g=()=>"dev"===e||"development"===e,h=()=>{var a;return"test"===e||!!(a=d.TEST)&&"false"!==a};function i(a,b){return"undefined"!=typeof process&&process.env?process.env[a]??b:"undefined"!=typeof Deno?Deno.env.get(a)??b:"undefined"!=typeof Bun?Bun.env[a]??b:b}function j(a,b=!0){let c=i(a);return c?"0"!==c&&"false"!==c.toLowerCase()&&""!==c:b}let k=Object.freeze({get BETTER_AUTH_SECRET(){return i("BETTER_AUTH_SECRET")},get AUTH_SECRET(){return i("AUTH_SECRET")},get BETTER_AUTH_TELEMETRY(){return i("BETTER_AUTH_TELEMETRY")},get BETTER_AUTH_TELEMETRY_ID(){return i("BETTER_AUTH_TELEMETRY_ID")},get NODE_ENV(){return i("NODE_ENV","development")},get PACKAGE_VERSION(){return i("PACKAGE_VERSION","0.0.0")},get BETTER_AUTH_TELEMETRY_ENDPOINT(){return i("BETTER_AUTH_TELEMETRY_ENDPOINT","https://telemetry.better-auth.com/v1/track")}}),l={eterm:4,cons25:4,console:4,cygwin:4,dtterm:4,gnome:4,hurd:4,jfbterm:4,konsole:4,kterm:4,mlterm:4,mosh:24,putty:4,st:4,"rxvt-unicode-24bit":24,terminator:24,"xterm-kitty":24},m=new Map(Object.entries({APPVEYOR:8,BUILDKITE:8,CIRCLECI:24,DRONE:8,GITEA_ACTIONS:24,GITHUB_ACTIONS:24,GITLAB_CI:8,TRAVIS:8})),n=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/];function o(){if(void 0!==i("FORCE_COLOR"))switch(i("FORCE_COLOR")){case"":case"1":case"true":return 4;case"2":return 8;case"3":return 24;default:return 1}if(void 0!==i("NODE_DISABLE_COLORS")&&""!==i("NODE_DISABLE_COLORS")||void 0!==i("NO_COLOR")&&""!==i("NO_COLOR")||"dumb"===i("TERM"))return 1;if(i("TMUX"))return 24;if("TF_BUILD"in d&&"AGENT_NAME"in d)return 4;if("CI"in d){for(let{0:a,1:b}of m)if(a in d)return b;return"codeship"===i("CI_NAME")?8:1}if("TEAMCITY_VERSION"in d)return null!==/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec(i("TEAMCITY_VERSION"))?4:1;switch(i("TERM_PROGRAM")){case"iTerm.app":if(!i("TERM_PROGRAM_VERSION")||null!==/^[0-2]\./.exec(i("TERM_PROGRAM_VERSION")))return 8;return 24;case"HyperTerm":case"MacTerm":return 24;case"Apple_Terminal":return 8}if("truecolor"===i("COLORTERM")||"24bit"===i("COLORTERM"))return 24;if(i("TERM")){if(null!==/truecolor/.exec(i("TERM")))return 24;if(null!==/^xterm-256/.exec(i("TERM")))return 8;let a=i("TERM").toLowerCase();if(l[a])return l[a];if(n.some(b=>null!==b.exec(a)))return 4}return i("COLORTERM")?4:1}let p={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",undim:"\x1b[22m",underscore:"\x1b[4m",blink:"\x1b[5m",reverse:"\x1b[7m",hidden:"\x1b[8m",fg:{black:"\x1b[30m",red:"\x1b[31m",green:"\x1b[32m",yellow:"\x1b[33m",blue:"\x1b[34m",magenta:"\x1b[35m",cyan:"\x1b[36m",white:"\x1b[37m"},bg:{black:"\x1b[40m",red:"\x1b[41m",green:"\x1b[42m",yellow:"\x1b[43m",blue:"\x1b[44m",magenta:"\x1b[45m",cyan:"\x1b[46m",white:"\x1b[47m"}},q=["debug","info","success","warn","error"];function r(a,b){return q.indexOf(b)>=q.indexOf(a)}let s={info:p.fg.blue,success:p.fg.green,warn:p.fg.yellow,error:p.fg.red,debug:p.fg.magenta},t=a=>{let b=a?.disabled!==!0,c=a?.level??"error",d=a?.disableColors!==void 0?!a.disableColors:1!==o();return{...Object.fromEntries(q.map(e=>[e,(...[f,...g])=>((e,f,g=[])=>{let h;if(!b||!r(c,e))return;let i=(h=new Date().toISOString(),d?`${p.dim}${h}${p.reset} ${s[e]}${e.toUpperCase()}${p.reset} ${p.bright}[Better Auth]:${p.reset} ${f}`:`${h} ${e.toUpperCase()} [Better Auth]: ${f}`);a&&"function"==typeof a.log?a.log("success"===e?"info":e,f,...g):"error"===e?console.error(i,...g):"warn"===e?console.warn(i,...g):console.log(i,...g)})(e,f,g)])),get level(){return c}}},u=t();function v(a){switch(a){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw Error(`Unsupported alphabet: ${a}`)}}function w(...a){let b=a.map(v).join("");if(0===b.length)throw Error("No valid characters provided for random string generation.");let c=b.length;return(a,...d)=>{let e;if(a<=0)throw Error("Length must be a positive integer.");let f=b,g=c;d.length>0&&(g=(f=d.map(v).join("")).length);let h=Math.floor(256/g)*g,i=new Uint8Array(2*a),j=i.length,k="",l=j;for(;k.length<a;)l>=j&&(crypto.getRandomValues(i),l=0),(e=i[l++])<h&&(k+=f[e%g]);return k}}function x(a){return a}a.s(["a",()=>r,"c",()=>d,"d",()=>g,"f",()=>f,"i",()=>u,"l",()=>j,"m",()=>e,"n",()=>t,"o",()=>o,"p",()=>h,"r",()=>q,"s",()=>k,"t",()=>p,"u",()=>i],70755),a.s(["createRandomStringGenerator",()=>w],85078);let y=a=>w("a-z","A-Z","0-9")(a||32);function z(a){try{if("string"!=typeof a)return a;return JSON.parse(a,function(a,b){if("string"==typeof b&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(b)){let a=new Date(b);if(!isNaN(a.getTime()))return a}return b})}catch(a){return u.error("Error parsing JSON",{error:a}),null}}function A(a){return a.charAt(0).toUpperCase()+a.slice(1)}a.s(["i",()=>x,"n",()=>z,"r",()=>y,"t",()=>A],56771);let B={USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_USER:"Failed to create user",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_UPDATE_USER:"Failed to update user",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",SOCIAL_ACCOUNT_ALREADY_LINKED:"Social account already linked",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"Invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists.",USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL:"User already exists. Use another email.",EMAIL_CAN_NOT_BE_UPDATED:"Email can not be updated",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found",USER_ALREADY_HAS_PASSWORD:"User already has a password. Provide that to delete the account."};var C=class extends Error{constructor(a,b){super(a),this.name="BetterAuthError",this.message=a,this.cause=b,this.stack=""}};a.s(["n",()=>B,"t",()=>C],55069)},80479,14956,a=>{"use strict";let b=a=>{let b=(a.plugins??[]).reduce((a,b)=>{let c=b.schema;if(!c)return a;for(let[b,d]of Object.entries(c))a[b]={fields:{...a[b]?.fields,...d.fields},modelName:d.modelName||b};return a},{}),c=a.rateLimit?.storage==="database",d={rateLimit:{modelName:a.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:a.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:a.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",bigint:!0,fieldName:a.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:e,session:f,account:g,...h}=b,i={session:{modelName:a.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:a.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:a.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:a.session?.fields?.createdAt||"createdAt",defaultValue:()=>new Date},updatedAt:{type:"date",required:!0,fieldName:a.session?.fields?.updatedAt||"updatedAt",onUpdate:()=>new Date},ipAddress:{type:"string",required:!1,fieldName:a.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:a.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:a.session?.fields?.userId||"userId",references:{model:a.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,index:!0},...f?.fields,...a.session?.additionalFields},order:2}};return{user:{modelName:a.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:a.user?.fields?.name||"name",sortable:!0},email:{type:"string",unique:!0,required:!0,fieldName:a.user?.fields?.email||"email",sortable:!0},emailVerified:{type:"boolean",defaultValue:!1,required:!0,fieldName:a.user?.fields?.emailVerified||"emailVerified",input:!1},image:{type:"string",required:!1,fieldName:a.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:a.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,onUpdate:()=>new Date,required:!0,fieldName:a.user?.fields?.updatedAt||"updatedAt"},...e?.fields,...a.user?.additionalFields},order:1},...!a.secondaryStorage||a.session?.storeSessionInDatabase?i:{},account:{modelName:a.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:a.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:a.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:a.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:a.account?.fields?.userId||"userId",index:!0},accessToken:{type:"string",required:!1,fieldName:a.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:a.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:a.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:a.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:a.account?.fields?.refreshTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:a.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:a.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:a.account?.fields?.createdAt||"createdAt",defaultValue:()=>new Date},updatedAt:{type:"date",required:!0,fieldName:a.account?.fields?.updatedAt||"updatedAt",onUpdate:()=>new Date},...g?.fields,...a.account?.additionalFields},order:3},verification:{modelName:a.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:a.verification?.fields?.identifier||"identifier",index:!0},value:{type:"string",required:!0,fieldName:a.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:a.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!0,defaultValue:()=>new Date,fieldName:a.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,defaultValue:()=>new Date,onUpdate:()=>new Date,fieldName:a.verification?.fields?.updatedAt||"updatedAt"}},order:4},...h,...c?d:{}}};a.s(["t",()=>b],14956);var c=a.i(70755),d=a.i(56771),e=a.i(55069);let f=({usePlural:a,schema:b})=>c=>{if(a&&"s"===c.charAt(c.length-1)){let a=c.slice(0,-1),d=b[a]?a:void 0;if(d||(d=Object.entries(b).find(([b,c])=>c.modelName===a)?.[0]),d)return d}let d=b[c]?c:void 0;if(d||(d=Object.entries(b).find(([a,b])=>b.modelName===c)?.[0]),!d)throw new e.t(`Model "${c}" not found in schema`);return d},g=({schema:a,usePlural:b})=>{let c=f({schema:a,usePlural:b});return({field:b,model:d})=>{if("id"===b||"_id"===b)return"id";let f=c(d),g=a[f]?.fields[b];if(!g){let c=Object.entries(a[f].fields).find(([a,c])=>c.fieldName===b);c&&(g=c[1],b=c[0])}if(!g)throw new e.t(`Field ${b} not found in model ${f}`);return b}},h=({usePlural:a,schema:b,disableIdGeneration:e,options:g,customIdGenerator:h,supportsUUIDs:i})=>{let j=f({usePlural:a,schema:b});return({customModelName:a,forceAllowId:b})=>{let f=g.advanced?.database?.useNumberId||g.advanced?.database?.generateId==="serial",k=g.advanced?.database?.generateId==="uuid",l=!e&&(!f||!!b)&&(!k||!i),m=j(a??"id");return{type:f?"number":"string",required:!!l,...l?{defaultValue(){if(e)return;let a=g.advanced?.database?.generateId;if(!1!==a&&!f)return"function"==typeof a?a({model:m}):h?h({model:m}):"uuid"===a?crypto.randomUUID():(0,d.r)()}}:{},transform:{input:a=>{if(a){if(f){let b=Number(a);if(isNaN(b))return;return b}if(k){if(l&&!b)return a;if(e||i)return;if(b&&"string"==typeof a)if(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a))return a;else{let a=Error().stack?.split("\n").filter((a,b)=>1!==b).join("\n").replace("Error:","");c.i.warn("[Adapter Factory] - Invalid UUID value for field `id` provided when `forceAllowId` is true. Generating a new UUID.",a)}return"string"==typeof a||i?void 0:crypto.randomUUID()}return a}},output:a=>{if(a)return String(a)}}}}},i=({schema:a,usePlural:b})=>{let c=f({schema:a,usePlural:b}),d=g({schema:a,usePlural:b});return function({model:b,field:e}){let f=c(b),g=d({model:f,field:e});return a[f]?.fields[g]?.fieldName||g}},j=({usePlural:a,schema:b})=>{let c=f({schema:b,usePlural:a});return d=>{let e=c(d);return b&&b[e]&&b[e].modelName!==d?a?`${b[e].modelName}s`:b[e].modelName:a?`${d}s`:d}},k=[],l=-1,m=({adapter:a,config:m})=>r=>{let s=Math.random().toString(36).substring(2,15),t={...m,supportsBooleans:m.supportsBooleans??!0,supportsDates:m.supportsDates??!0,supportsJSON:m.supportsJSON??!1,adapterName:m.adapterName??m.adapterId,supportsNumericIds:m.supportsNumericIds??!0,supportsUUIDs:m.supportsUUIDs??!1,supportsArrays:m.supportsArrays??!1,transaction:m.transaction??!1,disableTransformInput:m.disableTransformInput??!1,disableTransformOutput:m.disableTransformOutput??!1,disableTransformJoin:m.disableTransformJoin??!1};if((r.advanced?.database?.useNumberId===!0||r.advanced?.database?.generateId==="serial")&&!1===t.supportsNumericIds)throw new e.t(`[${t.adapterName}] Your database or database adapter does not support numeric ids. Please disable "useNumberId" in your config.`);let u=b(r),v=(...a)=>{if(!0===t.debugLogs||"object"==typeof t.debugLogs){let b=(0,c.n)({level:"info"});if("object"==typeof t.debugLogs&&"isRunningAdapterTests"in t.debugLogs){t.debugLogs.isRunningAdapterTests&&(a.shift(),k.push({instance:s,args:a}));return}if("object"!=typeof t.debugLogs||!t.debugLogs.logCondition||t.debugLogs.logCondition?.())if("object"==typeof a[0]&&"method"in a[0]){let c=a.shift().method;if("object"==typeof t.debugLogs){if("create"===c&&!t.debugLogs.create)return;else if("update"===c&&!t.debugLogs.update)return;else if("updateMany"===c&&!t.debugLogs.updateMany)return;else if("findOne"===c&&!t.debugLogs.findOne)return;else if("findMany"===c&&!t.debugLogs.findMany)return;else if("delete"===c&&!t.debugLogs.delete)return;else if("deleteMany"===c&&!t.debugLogs.deleteMany)return;else if("count"===c&&!t.debugLogs.count)return}b.info(`[${t.adapterName}]`,...a)}else b.info(`[${t.adapterName}]`,...a)}},w=(0,c.n)(r.logger),x=f({usePlural:t.usePlural,schema:u}),y=g({usePlural:t.usePlural,schema:u}),z=j({usePlural:t.usePlural,schema:u}),A=i({schema:u,usePlural:t.usePlural}),B=h({schema:u,options:r,usePlural:t.usePlural,disableIdGeneration:t.disableIdGeneration,customIdGenerator:t.customIdGenerator,supportsUUIDs:t.supportsUUIDs}),C=(({usePlural:a,schema:b,options:c,customIdGenerator:d,disableIdGeneration:i})=>{let j=f({usePlural:a,schema:b}),k=g({usePlural:a,schema:b}),l=h({usePlural:a,schema:b,options:c,customIdGenerator:d,disableIdGeneration:i});return({model:a,field:c})=>{let d=j(a),f=k({field:c,model:d}),g=b[d].fields;g.id=l({customModelName:d});let h=g[f];if(!h)throw new e.t(`Field ${c} not found in model ${a}`);return h}})({schema:u,options:r,usePlural:t.usePlural,disableIdGeneration:t.disableIdGeneration,customIdGenerator:t.customIdGenerator}),D=async(a,b,c,d)=>{let e={},f=u[b].fields,g=t.mapKeysTransformInput??{},h=r.advanced?.database?.useNumberId||r.advanced?.database?.generateId==="serial";for(let i in f.id=B({customModelName:b,forceAllowId:d&&"id"in a}),f){let d=a[i],j=f[i],k=g[i]||f[i].fieldName||i;if(void 0===d&&(void 0===j.defaultValue&&!j.transform?.input&&!("update"===c&&j.onUpdate)||"update"===c&&!j.onUpdate))continue;if(j&&"date"===j.type&&!(d instanceof Date)&&"string"==typeof d)try{d=new Date(d)}catch{w.error("[Adapter Factory] Failed to convert string to date",{value:d,field:i})}let l=function(a,b,c){if("update"===c)return void 0===a&&void 0!==b.onUpdate?"function"==typeof b.onUpdate?b.onUpdate():b.onUpdate:a;return"create"===c&&(void 0===a||!0===b.required&&null===a)&&void 0!==b.defaultValue?"function"==typeof b.defaultValue?b.defaultValue():b.defaultValue:a}(d,j,c);j.transform?.input&&(l=await j.transform.input(l)),j.references?.field==="id"&&h?l=Array.isArray(l)?l.map(a=>null!==a?Number(a):null):null!==l?Number(l):null:!1===t.supportsJSON&&"object"==typeof l&&"json"===j.type||!1===t.supportsArrays&&Array.isArray(l)&&("string[]"===j.type||"number[]"===j.type)?l=JSON.stringify(l):!1===t.supportsDates&&l instanceof Date&&"date"===j.type?l=l.toISOString():!1===t.supportsBooleans&&"boolean"==typeof l&&(l=+!!l),t.customTransformInput&&(l=t.customTransformInput({data:l,action:c,field:k,fieldAttributes:j,model:z(b),schema:u,options:r})),void 0!==l&&(e[k]=l)}return e},E=async(a,b,c=[],e)=>{let f=async(a,b,c=[])=>{if(!a)return null;let e=t.mapKeysTransformOutput??{},f={},g=u[x(b)].fields;for(let h in g[Object.entries(e).find(([a,b])=>"id"===b)?.[0]??"id"]={type:r.advanced?.database?.useNumberId||r.advanced?.database?.generateId==="serial"?"number":"string"},g){if(c.length&&!c.includes(h))continue;let i=g[h];if(i){let g=i.fieldName||h,j=a[Object.entries(e).find(([a,b])=>b===g)?.[0]||g];i.transform?.output&&(j=await i.transform.output(j));let k=e[h]||h;"id"===g||i.references?.field==="id"?null!=j&&(j=String(j)):!1===t.supportsJSON&&"string"==typeof j&&"json"===i.type||!1===t.supportsArrays&&"string"==typeof j&&("string[]"===i.type||"number[]"===i.type)?j=(0,d.n)(j):!1===t.supportsDates&&"string"==typeof j&&"date"===i.type?j=new Date(j):!1===t.supportsBooleans&&"number"==typeof j&&"boolean"===i.type&&(j=1===j),t.customTransformOutput&&(j=t.customTransformOutput({data:j,field:k,fieldAttributes:i,select:c,model:z(b),schema:u,options:r})),f[k]=j}}return f};if(!e||0===Object.keys(e).length)return await f(a,b,c);b=x(b);let g=await f(a,b,c),h=Object.entries(e).map(([a,b])=>({modelName:z(a),defaultModelName:x(a),joinConfig:b}));if(!a)return null;for(let{modelName:c,defaultModelName:d,joinConfig:e}of h){let h=await (async()=>r.experimental?.joins?a[c]:await H({baseModel:b,baseData:g,joinModel:c,specificJoinConfig:e}))();null==h&&(h="one-to-one"===e.relation?null:[]),"one-to-many"!==e.relation||Array.isArray(h)||(h=[h]);let i=[];if(Array.isArray(h))for(let a of h){let b=await f(a,c,[]);i.push(b)}else{let a=await f(h,c,[]);i.push(a)}g[d]=("one-to-one"===e.relation?i[0]:i)??null}return g},F=({model:a,where:b})=>{if(!b)return;let c=t.mapKeysTransformInput??{};return b.map(b=>{let{field:d,value:f,operator:g="eq",connector:h="AND"}=b;if("in"===g&&!Array.isArray(f))throw new e.t("Value must be an array");let i=f,j=x(a),k=y({field:d,model:a}),l=c[k]||A({field:k,model:j}),m=C({field:k,model:j}),n=r.advanced?.database?.useNumberId||r.advanced?.database?.generateId==="serial";if(("id"===k||m.references?.field==="id")&&n&&(i=Array.isArray(f)?f.map(Number):Number(f)),"date"===m.type&&f instanceof Date&&!t.supportsDates&&(i=f.toISOString()),"boolean"!==m.type||"boolean"!=typeof f||t.supportsBooleans||(i=+!!f),"json"===m.type&&"object"==typeof f&&!t.supportsJSON)try{i=JSON.stringify(f)}catch(a){throw Error(`Failed to stringify JSON value for field ${l}`,{cause:a})}return{operator:g,connector:h,field:l,value:i}})},G=(a,b,c)=>{if(!b||0===Object.keys(b).length)return;let d={};for(let[f,g]of Object.entries(b)){let b,h,i;if(!g)continue;let j=x(f),k=x(a),l=Object.entries(u[j].fields).filter(([a,b])=>b.references&&x(b.references.model)===k),m=!0;if(l.length||(l=Object.entries(u[k].fields).filter(([a,b])=>b.references&&x(b.references.model)===j),m=!1),l.length){if(l.length>1)throw new e.t(`Multiple foreign keys found for model ${f} and base model ${a} while performing join operation. Only one foreign key is supported.`)}else throw new e.t(`No foreign key found for model ${f} and base model ${a} while performing join operation.`);let[n,o]=l[0];if(!o.references)throw new e.t(`No references found for foreign key ${n} on model ${f} while performing join operation.`);m?(b=A({model:a,field:i=o.references.field}),h=A({model:f,field:n})):(b=A({model:a,field:i=n}),h=A({model:f,field:o.references.field})),c&&!c.includes(i)&&c.push(i);let p="id"===h||(o.unique??!1),q=r.advanced?.database?.defaultFindManyLimit??100;p?q=1:"object"==typeof g&&"number"==typeof g.limit&&(q=g.limit),d[z(f)]={on:{from:b,to:h},limit:q,relation:p?"one-to-one":"one-to-many"}}return{join:d,select:c}},H=async({baseModel:a,baseData:b,joinModel:c,specificJoinConfig:d})=>{let e;if(!b)return b;let f=z(c),g=d.on.to,h=b[y({field:d.on.from,model:a})];if(null==h)return"one-to-one"===d.relation?null:[];let i=F({model:f,where:[{field:g,value:h,operator:"eq",connector:"AND"}]});try{if("one-to-one"===d.relation)e=await I.findOne({model:f,where:i});else{let a=d.limit??r.advanced?.database?.defaultFindManyLimit??100;e=await I.findMany({model:f,where:i,limit:a})}}catch(a){throw w.error(`Failed to query fallback join for model ${f}:`,{where:i,limit:d.limit}),console.error(a),a}return e},I=a({options:r,schema:u,debugLog:v,getFieldName:A,getModelName:z,getDefaultModelName:x,getDefaultFieldName:y,getFieldAttributes:C,transformInput:D,transformOutput:E,transformWhereClause:F}),J=null,K={transaction:async a=>{if(!J)if(t.transaction)w.debug(`[${t.adapterName}] - Using provided transaction implementation.`),J=t.transaction;else J=a=>a(K);return J(a)},create:async({data:a,model:b,select:c,forceAllowId:d=!1})=>{let e=++l,f=z(b);b=x(b),"id"in a&&void 0!==a.id&&!d&&(w.warn(`[${t.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you, unless you pass in the \`forceAllowId\` parameter. The id will be ignored.`),console.log(Error().stack?.split("\n").filter((a,b)=>1!==b).join("\n").replace("Error:","Create method with `id` being called at:")),a.id=void 0),v({method:"create"},`${n(e)} ${o(1,4)}`,`${p("create")} ${q("Unsafe Input")}:`,{model:f,data:a});let g=a;t.disableTransformInput||(g=await D(a,b,"create",d)),v({method:"create"},`${n(e)} ${o(2,4)}`,`${p("create")} ${q("Parsed Input")}:`,{model:f,data:g});let h=await I.create({data:g,model:f});v({method:"create"},`${n(e)} ${o(3,4)}`,`${p("create")} ${q("DB Result")}:`,{model:f,res:h});let i=h;return t.disableTransformOutput||(i=await E(h,b,c,void 0)),v({method:"create"},`${n(e)} ${o(4,4)}`,`${p("create")} ${q("Parsed Result")}:`,{model:f,data:i}),i},update:async({model:a,where:b,update:c})=>{let d=++l,e=z(a=x(a)),f=F({model:a,where:b});v({method:"update"},`${n(d)} ${o(1,4)}`,`${p("update")} ${q("Unsafe Input")}:`,{model:e,data:c});let g=c;t.disableTransformInput||(g=await D(c,a,"update")),v({method:"update"},`${n(d)} ${o(2,4)}`,`${p("update")} ${q("Parsed Input")}:`,{model:e,data:g});let h=await I.update({model:e,where:f,update:g});v({method:"update"},`${n(d)} ${o(3,4)}`,`${p("update")} ${q("DB Result")}:`,{model:e,data:h});let i=h;return t.disableTransformOutput||(i=await E(h,a,void 0,void 0)),v({method:"update"},`${n(d)} ${o(4,4)}`,`${p("update")} ${q("Parsed Result")}:`,{model:e,data:i}),i},updateMany:async({model:a,where:b,update:c})=>{let d=++l,e=z(a),f=F({model:a,where:b});a=x(a),v({method:"updateMany"},`${n(d)} ${o(1,4)}`,`${p("updateMany")} ${q("Unsafe Input")}:`,{model:e,data:c});let g=c;t.disableTransformInput||(g=await D(c,a,"update")),v({method:"updateMany"},`${n(d)} ${o(2,4)}`,`${p("updateMany")} ${q("Parsed Input")}:`,{model:e,data:g});let h=await I.updateMany({model:e,where:f,update:g});return v({method:"updateMany"},`${n(d)} ${o(3,4)}`,`${p("updateMany")} ${q("DB Result")}:`,{model:e,data:h}),v({method:"updateMany"},`${n(d)} ${o(4,4)}`,`${p("updateMany")} ${q("Parsed Result")}:`,{model:e,data:h}),h},findOne:async({model:a,where:b,select:c,join:d})=>{let e,f=++l,g=z(a),h=F({model:a,where:b});a=x(a);let i=!0;if(t.disableTransformJoin)e=d;else{let b=G(a,d,c);b&&(e=b.join,c=b.select),!r.experimental?.joins&&e&&Object.keys(e).length>0&&(i=!1)}v({method:"findOne"},`${n(f)} ${o(1,3)}`,`${p("findOne")}:`,{model:g,where:h,select:c,join:e});let j=await I.findOne({model:g,where:h,select:c,join:i?e:void 0});v({method:"findOne"},`${n(f)} ${o(2,3)}`,`${p("findOne")} ${q("DB Result")}:`,{model:g,data:j});let k=j;return t.disableTransformOutput||(k=await E(j,a,c,e)),v({method:"findOne"},`${n(f)} ${o(3,3)}`,`${p("findOne")} ${q("Parsed Result")}:`,{model:g,data:k}),k},findMany:async({model:a,where:b,limit:c,sortBy:d,offset:e,join:f})=>{let g,h=++l,i=c??r.advanced?.database?.defaultFindManyLimit??100,j=z(a),k=F({model:a,where:b});a=x(a);let m=!0;if(t.disableTransformJoin)g=f;else{let b=G(a,f,void 0);b&&(g=b.join),!r.experimental?.joins&&g&&Object.keys(g).length>0&&(m=!1)}v({method:"findMany"},`${n(h)} ${o(1,3)}`,`${p("findMany")}:`,{model:j,where:k,limit:i,sortBy:d,offset:e,join:g});let s=await I.findMany({model:j,where:k,limit:i,sortBy:d,offset:e,join:m?g:void 0});v({method:"findMany"},`${n(h)} ${o(2,3)}`,`${p("findMany")} ${q("DB Result")}:`,{model:j,data:s});let u=s;return t.disableTransformOutput||(u=await Promise.all(s.map(async b=>await E(b,a,void 0,g)))),v({method:"findMany"},`${n(h)} ${o(3,3)}`,`${p("findMany")} ${q("Parsed Result")}:`,{model:j,data:u}),u},delete:async({model:a,where:b})=>{let c=++l,d=z(a),e=F({model:a,where:b});a=x(a),v({method:"delete"},`${n(c)} ${o(1,2)}`,`${p("delete")}:`,{model:d,where:e}),await I.delete({model:d,where:e}),v({method:"delete"},`${n(c)} ${o(2,2)}`,`${p("delete")} ${q("DB Result")}:`,{model:d})},deleteMany:async({model:a,where:b})=>{let c=++l,d=z(a),e=F({model:a,where:b});a=x(a),v({method:"deleteMany"},`${n(c)} ${o(1,2)}`,`${p("deleteMany")} ${q("DeleteMany")}:`,{model:d,where:e});let f=await I.deleteMany({model:d,where:e});return v({method:"deleteMany"},`${n(c)} ${o(2,2)}`,`${p("deleteMany")} ${q("DB Result")}:`,{model:d,data:f}),f},count:async({model:a,where:b})=>{let c=++l,d=z(a),e=F({model:a,where:b});a=x(a),v({method:"count"},`${n(c)} ${o(1,2)}`,`${p("count")}:`,{model:d,where:e});let f=await I.count({model:d,where:e});return v({method:"count"},`${n(c)} ${o(2,2)}`,`${p("count")}:`,{model:d,data:f}),f},createSchema:I.createSchema?async(a,c)=>{let d=b(r);return r.secondaryStorage&&!r.session?.storeSessionInDatabase&&delete d.session,r.rateLimit&&"database"===r.rateLimit.storage&&(void 0===r.rateLimit.enabled||!0===r.rateLimit.enabled)&&(d.ratelimit={modelName:r.rateLimit.modelName??"ratelimit",fields:{key:{type:"string",unique:!0,required:!0,fieldName:r.rateLimit.fields?.key??"key"},count:{type:"number",required:!0,fieldName:r.rateLimit.fields?.count??"count"},lastRequest:{type:"number",required:!0,bigint:!0,defaultValue:()=>Date.now(),fieldName:r.rateLimit.fields?.lastRequest??"lastRequest"}}}),I.createSchema({file:c,tables:d})}:void 0,options:{adapterConfig:t,...I.options??{}},id:t.adapterId,...t.debugLogs?.isRunningAdapterTests?{adapterTestDebugLogs:{resetDebugLogs(){k=k.filter(a=>a.instance!==s)},printDebugLogs(){let a=`â”€`.repeat(80),b=k.filter(a=>a.instance===s);0===b.length||console.log(...b.reverse().map(a=>(a.args[0]=`
${a.args[0]}`,[...a.args,"\n"])).reduce((a,b)=>[...b,...a],[`
${a}`]))}}}:{}};return K};function n(a){return 8>(0,c.o)()?`#${a}`:`${c.t.fg.magenta}#${a}${c.t.reset}`}function o(a,b){return`${c.t.bg.black}${c.t.fg.yellow}[${a}/${b}]${c.t.reset}`}function p(a){return`${c.t.bright}${a}${c.t.reset}`}function q(a){return`${c.t.dim}(${a})${c.t.reset}`}a.s(["createAdapterFactory",()=>m,"initGetFieldName",()=>i,"initGetModelName",()=>j],80479)}];

//# sourceMappingURL=node_modules_%40better-auth_core_dist_e2a66b8d._.js.map